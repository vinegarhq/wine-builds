From b676cbfdbd5ed3d140c57a4bdb7ffbe575eff1cb Mon Sep 17 00:00:00 2001
From: Elizabeth Figura <zfigura@codeweavers.com>
Date: Fri, 19 Dec 2025 16:12:54 -0600
Subject: [PATCH 31/33] wined3d: Avoid some invalidation when texture states
 are set redundantly.

Wine-Bug: https://bugs.winehq.org/show_bug.cgi?id=59013
---
 dlls/wined3d/stateblock.c | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/dlls/wined3d/stateblock.c b/dlls/wined3d/stateblock.c
index 71ef3d33b99..c40dcf1380b 100644
--- a/dlls/wined3d/stateblock.c
+++ b/dlls/wined3d/stateblock.c
@@ -1799,6 +1799,12 @@ void CDECL wined3d_stateblock_set_texture_stage_state(struct wined3d_stateblock
         return;
     }
 
+    if (stateblock->type == WINED3D_SBT_PRIMARY && value == stateblock->stateblock_state.texture_states[stage][state])
+    {
+        TRACE("Ignoring redundant call on a primary stateblock.\n");
+        return;
+    }
+
     stateblock->stateblock_state.texture_states[stage][state] = value;
     stateblock->changed.textureState[stage] |= 1u << state;
 
-- 
2.52.0

