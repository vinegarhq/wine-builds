From 656ff157ffdefa70e4cb79f5274ed5ed8e2fe99d Mon Sep 17 00:00:00 2001
From: sewn <sewn@disroot.org>
Date: Sun, 21 Dec 2025 16:55:13 +0300
Subject: [PATCH 34/48] winex11: Add Xwayland check

Signed-off-by: sewn <sewn@disroot.org>
---
 dlls/winex11.drv/x11drv.h      | 1 +
 dlls/winex11.drv/x11drv_main.c | 3 +++
 2 files changed, 4 insertions(+)

diff --git a/dlls/winex11.drv/x11drv.h b/dlls/winex11.drv/x11drv.h
index 34f34724391..2acbb4537ae 100644
--- a/dlls/winex11.drv/x11drv.h
+++ b/dlls/winex11.drv/x11drv.h
@@ -472,6 +472,7 @@ extern BOOL grab_fullscreen;
 extern int keyboard_layout;
 extern BOOL keyboard_scancode_detect;
 extern BOOL usexcomposite;
+extern BOOL xwayland;
 extern BOOL use_xfixes;
 extern BOOL managed_mode;
 extern BOOL private_color_map;
diff --git a/dlls/winex11.drv/x11drv_main.c b/dlls/winex11.drv/x11drv_main.c
index e719f848a0c..c6a971684b2 100644
--- a/dlls/winex11.drv/x11drv_main.c
+++ b/dlls/winex11.drv/x11drv_main.c
@@ -70,6 +70,7 @@ BOOL usexvidmode = TRUE;
 BOOL usexrandr = TRUE;
 BOOL usexcomposite = TRUE;
 BOOL use_egl = TRUE;
+BOOL xwayland = FALSE;
 BOOL use_xfixes = FALSE;
 BOOL use_take_focus = TRUE;
 BOOL use_primary_selection = FALSE;
@@ -810,6 +811,8 @@ static NTSTATUS x11drv_init( void *arg )
                    DisplayHeight( display, default_visual.screen ));
     X11DRV_Settings_Init();
 
+    xwayland = !strcmp(getenv("XDG_SESSION_TYPE"), "wayland");
+
     /* initialize XVidMode */
     X11DRV_XF86VM_Init();
     /* initialize XRandR */
-- 
2.52.0

