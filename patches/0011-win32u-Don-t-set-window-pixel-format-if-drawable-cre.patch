From 77cfb68b280513573ac46463c8f984d1966db72d Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?R=C3=A9mi=20Bernon?= <rbernon@codeweavers.com>
Date: Wed, 17 Dec 2025 13:10:51 +0100
Subject: [PATCH 11/20] win32u: Don't set window pixel format if drawable
 creation failed.

Wine-Bug: https://bugs.winehq.org/show_bug.cgi?id=59132
Signed-off-by: sewn <sewn@disroot.org>
---
 dlls/win32u/opengl.c | 10 ++++------
 1 file changed, 4 insertions(+), 6 deletions(-)

diff --git a/dlls/win32u/opengl.c b/dlls/win32u/opengl.c
index 40a8f6809a6..398a984e23e 100644
--- a/dlls/win32u/opengl.c
+++ b/dlls/win32u/opengl.c
@@ -1511,12 +1511,10 @@ static BOOL win32u_wglSetPixelFormat( HDC hdc, int new_format, const PIXELFORMAT
 
         if ((old_format = get_window_pixel_format( hwnd ))) return old_format == new_format;
 
-        if ((drawable = get_window_unused_drawable( hwnd, new_format )))
-        {
-            set_window_opengl_drawable( hwnd, drawable, TRUE );
-            set_window_opengl_drawable( hwnd, drawable, FALSE );
-            opengl_drawable_release( drawable );
-        }
+        if (!(drawable = get_window_unused_drawable( hwnd, new_format ))) return FALSE;
+        set_window_opengl_drawable( hwnd, drawable, TRUE );
+        set_window_opengl_drawable( hwnd, drawable, FALSE );
+        opengl_drawable_release( drawable );
 
         return set_window_pixel_format( hwnd, new_format, FALSE );
     }
-- 
2.52.0

