From 7923695e0e28aa61e31ec307f67d51f4d41cfb89 Mon Sep 17 00:00:00 2001
From: Elizabeth Figura <zfigura@codeweavers.com>
Date: Fri, 19 Dec 2025 16:12:04 -0600
Subject: [PATCH 43/51] wined3d: Avoid some invalidation when the vertex
 declaration is set redundantly.

Wine-Bug: https://bugs.winehq.org/show_bug.cgi?id=59013
Signed-off-by: sewn <sewn@disroot.org>
---
 dlls/wined3d/stateblock.c | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/dlls/wined3d/stateblock.c b/dlls/wined3d/stateblock.c
index efce0f6..64dc32f 100644
--- a/dlls/wined3d/stateblock.c
+++ b/dlls/wined3d/stateblock.c
@@ -1590,6 +1590,10 @@ void CDECL wined3d_stateblock_set_vertex_declaration(struct wined3d_stateblock *
         wined3d_vertex_declaration_decref(prev);
     stateblock->stateblock_state.vertex_declaration = declaration;
     stateblock->changed.vertexDecl = TRUE;
+
+    if (declaration == prev)
+        return;
+
     /* Texture matrices depend on the format of the TEXCOORD attributes. */
     /* FIXME: They also depend on whether the draw is pretransformed,
      * but that should go away. */
-- 
2.52.0

